import { describe, expect, it } from "bun:test";
import {
  getExploitTemplate,
  listExploitTemplates,
} from "../src/orchestration/exploit-templates";

describe("exploit templates", () => {
  it("lists templates (ALL)", () => {
    const listed = listExploitTemplates();
    expect(listed.length > 0).toBe(true);
    expect(listed.some((t) => t.domain === "PWN")).toBe(true);
  });

  it("lists templates by domain", () => {
    const pwn = listExploitTemplates("PWN");
    const crypto = listExploitTemplates("CRYPTO");
    expect(pwn.every((t) => t.domain === "PWN")).toBe(true);
    expect(crypto.every((t) => t.domain === "CRYPTO")).toBe(true);
  });

  it("gets template body by id", () => {
    const listed = listExploitTemplates("PWN");
    const first = listed[0];
    expect(first).toBeTruthy();
    const full = getExploitTemplate("PWN", first?.id ?? "");
    expect(full).not.toBeNull();
    expect(typeof full?.body).toBe("string");
    expect((full?.body ?? "").length > 0).toBe(true);
  });
});
